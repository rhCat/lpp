{
  "$schema": "lpp/v0.1.2",
  "id": "python_to_lpp",
  "name": "Python to L++ Refactorer",
  "version": "1.0.0",
  "description": "Refactors a Python repository into an L++ based project with full documentation",

  "states": {
    "idle": { "description": "Awaiting project path" },
    "scanning": { "description": "Scanning Python project structure" },
    "analyzing": { "description": "Analyzing code patterns and state machines" },
    "extracting": { "description": "Extracting business logic and workflows" },
    "generating_blueprints": { "description": "Generating L++ blueprints" },
    "generating_compute": { "description": "Generating compute functions" },
    "generating_docs": { "description": "Generating documentation" },
    "validating": { "description": "Validating generated artifacts" },
    "complete": { "description": "Refactoring complete" },
    "error": { "description": "Refactoring error" }
  },

  "entry_state": "idle",
  "terminal_states": ["complete", "error"],

  "context_schema": {
    "projectPath": "string",
    "outputPath": "string",
    "projectName": "string",
    "pythonFiles": "array",
    "extractedModules": "array",
    "blueprints": "array",
    "computeFunctions": "array",
    "options": {
      "includeTests": "boolean",
      "generateDocs": "boolean",
      "preserveOriginal": "boolean",
      "verbose": "boolean"
    },
    "results": {
      "modulesFound": "number",
      "blueprintsGenerated": "number",
      "docsGenerated": "number",
      "errors": "array"
    },
    "error": "string"
  },

  "gates": {
    "has_project": { "type": "expression", "expression": "projectPath is not None and len(projectPath) > 0" },
    "no_project": { "type": "expression", "expression": "projectPath is None or len(projectPath) == 0" },
    "has_python_files": { "type": "expression", "expression": "pythonFiles is not None and len(pythonFiles) > 0" },
    "no_python_files": { "type": "expression", "expression": "pythonFiles is None or len(pythonFiles) == 0" },
    "has_modules": { "type": "expression", "expression": "extractedModules is not None and len(extractedModules) > 0" },
    "has_blueprints": { "type": "expression", "expression": "blueprints is not None and len(blueprints) > 0" },
    "wants_docs": { "type": "expression", "expression": "options.get('generateDocs', True)" },
    "has_error": { "type": "expression", "expression": "error is not None" },
    "no_error": { "type": "expression", "expression": "error is None" }
  },

  "actions": {
    "init": { "type": "compute", "unit": "py2lpp:init" },
    "scan_project": { "type": "compute", "unit": "py2lpp:scanProject" },
    "analyze_patterns": { "type": "compute", "unit": "py2lpp:analyzePatterns" },
    "extract_modules": { "type": "compute", "unit": "py2lpp:extractModules" },
    "generate_blueprints": { "type": "compute", "unit": "py2lpp:generateBlueprints" },
    "generate_compute": { "type": "compute", "unit": "py2lpp:generateCompute" },
    "generate_docs": { "type": "compute", "unit": "py2lpp:generateDocs" },
    "validate": { "type": "compute", "unit": "py2lpp:validate" },
    "finalize": { "type": "compute", "unit": "py2lpp:finalize" }
  },

  "transitions": [
    { "id": "t0", "from": "idle", "to": "idle", "on_event": "START", "actions": ["init"] },
    { "id": "t1", "from": "idle", "to": "scanning", "on_event": "REFACTOR", "gates": ["has_project"], "actions": ["scan_project"] },
    { "id": "t2", "from": "idle", "to": "error", "on_event": "REFACTOR", "gates": ["no_project"] },
    { "id": "t3", "from": "scanning", "to": "analyzing", "on_event": "DONE", "gates": ["has_python_files", "no_error"], "actions": ["analyze_patterns"] },
    { "id": "t4", "from": "scanning", "to": "error", "on_event": "DONE", "gates": ["no_python_files"] },
    { "id": "t5", "from": "analyzing", "to": "extracting", "on_event": "DONE", "gates": ["no_error"], "actions": ["extract_modules"] },
    { "id": "t6", "from": "extracting", "to": "generating_blueprints", "on_event": "DONE", "gates": ["has_modules", "no_error"], "actions": ["generate_blueprints"] },
    { "id": "t7", "from": "generating_blueprints", "to": "generating_compute", "on_event": "DONE", "gates": ["has_blueprints", "no_error"], "actions": ["generate_compute"] },
    { "id": "t8", "from": "generating_compute", "to": "generating_docs", "on_event": "DONE", "gates": ["wants_docs", "no_error"], "actions": ["generate_docs"] },
    { "id": "t9", "from": "generating_compute", "to": "validating", "on_event": "DONE", "gates": ["no_error"], "actions": ["validate"] },
    { "id": "t10", "from": "generating_docs", "to": "validating", "on_event": "DONE", "gates": ["no_error"], "actions": ["validate"] },
    { "id": "t11", "from": "validating", "to": "complete", "on_event": "DONE", "gates": ["no_error"], "actions": ["finalize"] },
    { "id": "t12", "from": "*", "to": "error", "on_event": "ERROR", "gates": ["has_error"] },
    { "id": "t13", "from": "error", "to": "idle", "on_event": "RESET" },
    { "id": "t14", "from": "complete", "to": "idle", "on_event": "RESET" }
  ]
}
