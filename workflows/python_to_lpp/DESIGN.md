# Python to L++ Refactorer - Design Document

## Overview

This workflow orchestrates existing L++ utils tools to refactor a Python repository into an L++ based project with full documentation.

## Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                    python_to_lpp Workflow                       │
│                                                                 │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │   Scanner    │→ │   Analyzer   │→ │  Generator   │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
│         │                 │                 │                   │
└─────────┼─────────────────┼─────────────────┼───────────────────┘
          │                 │                 │
          ▼                 ▼                 ▼
┌─────────────────────────────────────────────────────────────────┐
│                        Utils Layer                              │
│                                                                 │
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐       │
│  │legacy_extractor│  │ logic_decoder │  │blueprint_builder│     │
│  └───────────────┘  └───────────────┘  └───────────────┘       │
│                                                                 │
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐       │
│  │ doc_generator │  │   dashboard   │  │graph_visualizer│      │
│  └───────────────┘  └───────────────┘  └───────────────┘       │
└─────────────────────────────────────────────────────────────────┘
```

## Workflow States

| State | Description | Utils Used |
|-------|-------------|------------|
| `idle` | Awaiting project path | - |
| `scanning` | Scanning Python project | - |
| `extracting` | Extracting legacy patterns | `legacy_extractor` |
| `decoding_logic` | Decoding logic patterns | `logic_decoder` |
| `generating_blueprints` | Creating L++ blueprints | - |
| `generating_docs` | Generating documentation | `doc_generator` |
| `generating_graphs` | Creating visualizations | `graph_visualizer` |
| `complete` | Refactoring complete | - |
| `error` | Error occurred | - |

## Utils Integration

### 1. legacy_extractor
Extracts state machine patterns from existing Python code:
- Class hierarchies with state attributes
- Event handlers (on_enter, on_exit)
- Transition methods

### 2. logic_decoder
Decodes business logic from Python functions:
- Control flow analysis
- Condition extraction (gates)
- Action identification

### 3. blueprint_builder
Builds L++ blueprints from extracted patterns:
- State extraction from modules
- Action generation from methods
- Gate extraction from conditions
- Transition generation
- Blueprint validation

### 4. doc_generator
Generates all documentation:
- Blueprint visualizations
- Mermaid diagrams
- README files
- Analysis reports

### 5. graph_visualizer
Creates interactive state graphs:
- HTML visualizations
- Zoom/pan controls
- Legend

### 6. dashboard
Aggregates all generated tools:
- Overview page
- Statistics
- Quick navigation

## Data Flow

```
Input: Python Project Path
         │
         ▼
┌─────────────────────────┐
│ 1. Scan Python Files    │
│    - Find .py files     │
│    - Parse AST          │
└────────────┬────────────┘
             │
             ▼
┌─────────────────────────┐
│ 2. Extract Patterns     │
│    [legacy_extractor]   │
│    - State machines     │
│    - Classes            │
│    - Functions          │
└────────────┬────────────┘
             │
             ▼
┌─────────────────────────┐
│ 3. Decode Logic         │
│    [logic_decoder]      │
│    - Control flow       │
│    - Conditions → Gates │
│    - Actions            │
└────────────┬────────────┘
             │
             ▼
┌─────────────────────────┐
│ 4. Generate Blueprints  │
│    - States             │
│    - Transitions        │
│    - Gates & Actions    │
└────────────┬────────────┘
             │
             ▼
┌─────────────────────────┐
│ 5. Generate Compute     │
│    - Function stubs     │
│    - Registry           │
└────────────┬────────────┘
             │
             ▼
┌─────────────────────────┐
│ 6. Generate Docs        │
│    [doc_generator]      │
│    - Graphs             │
│    - Mermaid            │
│    - READMEs            │
└────────────┬────────────┘
             │
             ▼
Output: L++ Project with Full Documentation
```

## Output Structure

```
<output_path>/
├── README.md                    # Project overview
├── refactor_summary.json        # Refactoring metadata
├── dashboard.html               # Generated by dashboard util
├── analysis_report.md           # Generated by doc_generator
│
├── <module_1>/
│   ├── <module_1>.json          # L++ blueprint
│   ├── src/
│   │   └── <module_1>_compute.py
│   ├── results/
│   │   ├── <module_1>_graph.html
│   │   ├── <module_1>_diagram.html
│   │   └── <module_1>.mmd
│   └── README.md
│
├── <module_2>/
│   └── ...
│
└── _source/                     # Original source reference
    └── (preserved if --preserve-original)
```

## Configuration Options

| Option | Default | Description |
|--------|---------|-------------|
| `projectPath` | required | Path to Python project |
| `outputPath` | `<project>/lpp_output` | Output directory |
| `includeTests` | `false` | Include test files |
| `generateDocs` | `true` | Run doc_generator |
| `preserveOriginal` | `true` | Copy original source |
| `verbose` | `false` | Detailed logging |

## Error Handling

The workflow handles errors at each stage:

1. **Scan errors**: Invalid paths, permission issues
2. **Parse errors**: Syntax errors in Python files
3. **Extraction errors**: Unsupported patterns
4. **Generation errors**: Template issues
5. **Documentation errors**: Missing dependencies

Errors are collected and reported in the final summary without stopping the entire workflow (fail-soft approach).

## Extension Points

### Adding New Pattern Recognizers

1. Create a new util in `utils/` following the L++ pattern
2. Register it in the workflow's compute functions
3. Add state/transition for the new step

### Custom Blueprint Templates

Edit `_generate_blueprint()` in `py2lpp_compute.py` to customize:
- State naming conventions
- Default transitions
- Gate expressions
- Action mappings

## Dependencies

Required utils (must exist in utils/):
- `legacy_extractor` - Pattern extraction
- `logic_decoder` - Logic analysis
- `doc_generator` - Documentation
- `graph_visualizer` - Visualization
- `dashboard` - Aggregation

Optional utils:
- `function_decoder` - Advanced function analysis
- `test_generator` - Generate test stubs
- `compliance_checker` - Validate blueprints
