{
  "$schema": "lpp/v0.2.0",
  "id": "lvp_report",
  "name": "LVP Report Component",
  "version": "1.0.0",
  "description": "Phase 6: Generate final audit report",
  "context_schema": {
    "properties": {
      "target_name": {
        "type": "string",
        "description": "Target name"
      },
      "target_path": {
        "type": "string",
        "description": "Target path"
      },
      "bone_json": {
        "type": "object",
        "description": "Logic blueprint"
      },
      "threat_model": {
        "type": "object",
        "description": "Threat model"
      },
      "invariants": {
        "type": "array",
        "description": "Safety invariants"
      },
      "counter_examples": {
        "type": "array",
        "description": "Counter-examples found"
      },
      "vulnerability_count": {
        "type": "number",
        "description": "Number of vulnerabilities"
      },
      "exploits": {
        "type": "array",
        "description": "Generated exploits"
      },
      "patches": {
        "type": "array",
        "description": "Generated patches"
      },
      "fix_verified": {
        "type": "boolean",
        "description": "Fix verified flag"
      },
      "severity_score": {
        "type": "number",
        "description": "Severity score 0-10"
      },
      "output_dir": {
        "type": "string",
        "description": "Output directory"
      },
      "run_id": {
        "type": "string",
        "description": "Run identifier"
      },
      "audit_report": {
        "type": "object",
        "description": "Final audit report"
      },
      "error": {
        "type": "string",
        "description": "Error message"
      }
    }
  },
  "states": {
    "idle": {
      "description": "Awaiting report request"
    },
    "generating": {
      "description": "Generating report"
    },
    "done": {
      "description": "Report complete"
    },
    "error": {
      "description": "Report generation failed"
    }
  },
  "entry_state": "idle",
  "terminal_states": {
    "done": {
      "output_schema": {
        "audit_report": {
          "type": "object",
          "non_null": true
        }
      },
      "invariants_guaranteed": [
        "report_generated"
      ]
    },
    "error": {
      "output_schema": {
        "error": {
          "type": "string",
          "non_null": true
        }
      }
    }
  },
  "gates": {
    "has_bone": {
      "type": "expression",
      "expression": "bone_json is not None"
    },
    "has_report": {
      "type": "expression",
      "expression": "audit_report is not None"
    },
    "has_error": {
      "type": "expression",
      "expression": "error is not None"
    },
    "no_error": {
      "type": "expression",
      "expression": "error is None"
    }
  },
  "actions": {
    "generate_report": {
      "type": "compute",
      "compute_unit": "lvp:generate_report",
      "input_map": {
        "target_name": "target_name",
        "target_path": "target_path",
        "bone_json": "bone_json",
        "threat_model": "threat_model",
        "invariants": "invariants",
        "counter_examples": "counter_examples",
        "vulnerability_count": "vulnerability_count",
        "exploits": "exploits",
        "patches": "patches",
        "fix_verified": "fix_verified",
        "severity_score": "severity_score",
        "output_dir": "output_dir",
        "run_id": "run_id"
      },
      "output_map": {
        "audit_report": "audit_report",
        "error": "error"
      }
    }
  },
  "transitions": [
    {
      "id": "t_start",
      "from": "idle",
      "to": "generating",
      "on_event": "REPORT",
      "gates": [
        "has_bone"
      ],
      "actions": [
        "generate_report"
      ]
    },
    {
      "id": "t_done",
      "from": "generating",
      "to": "done",
      "on_event": "COMPLETE",
      "gates": [
        "has_report",
        "no_error"
      ]
    },
    {
      "id": "t_error",
      "from": "generating",
      "to": "error",
      "on_event": "COMPLETE",
      "gates": [
        "has_error"
      ]
    }
  ]
}
