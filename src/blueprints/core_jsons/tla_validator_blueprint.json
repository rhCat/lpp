{
  "$schema": "lpp/v0.2.0",
  "id": "lpp_tla_validator",
  "name": "L++ TLA+ Validator",
  "version": "1.0.0",
  "description": "Generates and validates TLA+ specifications from blueprints",
  "context_schema": {
    "properties": {
      "error": {
        "type": "string"
      },
      "result": {
        "type": "object"
      },
      "blueprint": {
        "type": "object"
      },
      "tla_spec": {
        "type": "string"
      },
      "output_dir": {
        "type": "string"
      }
    }
  },
  "states": {
    "idle": {
      "name": "Idle",
      "description": "Ready to generate TLA+"
    },
    "extracting": {
      "name": "Extracting",
      "description": "Extracting domains and types"
    },
    "generating": {
      "name": "Generating",
      "description": "Generating TLA+ specification"
    },
    "validating": {
      "name": "Validating",
      "description": "Running TLC model checker"
    },
    "saving": {
      "name": "Saving",
      "description": "Saving TLA+ files"
    },
    "complete": {
      "name": "Complete",
      "description": "TLA+ generation complete"
    },
    "error": {
      "name": "Error",
      "description": "Generation or validation failed"
    }
  },
  "transitions": [
    {
      "id": "t_generate",
      "from": "idle",
      "to": "extracting",
      "on_event": "GENERATE"
    },
    {
      "id": "t_extracted",
      "from": "extracting",
      "to": "generating",
      "on_event": "EXTRACT_DONE"
    },
    {
      "id": "t_generated",
      "from": "generating",
      "to": "validating",
      "on_event": "GENERATE_DONE",
      "gates": [
        "g_do_validate"
      ]
    },
    {
      "id": "t_skip_validate",
      "from": "generating",
      "to": "saving",
      "on_event": "GENERATE_DONE"
    },
    {
      "id": "t_validated",
      "from": "validating",
      "to": "saving",
      "on_event": "VALIDATION_PASSED"
    },
    {
      "id": "t_saved",
      "from": "saving",
      "to": "complete",
      "on_event": "SAVE_DONE"
    },
    {
      "id": "t_extract_err",
      "from": "extracting",
      "to": "error",
      "on_event": "EXTRACT_ERROR"
    },
    {
      "id": "t_gen_err",
      "from": "generating",
      "to": "error",
      "on_event": "GENERATE_ERROR"
    },
    {
      "id": "t_validate_err",
      "from": "validating",
      "to": "error",
      "on_event": "VALIDATION_FAILED"
    },
    {
      "id": "t_save_err",
      "from": "saving",
      "to": "error",
      "on_event": "SAVE_ERROR"
    },
    {
      "id": "t_reset",
      "from": "*",
      "to": "idle",
      "on_event": "RESET"
    }
  ],
  "gates": {
    "g_has_blueprint": {
      "type": "expression",
      "expression": "blueprint is not None"
    },
    "g_do_validate": {
      "type": "expression",
      "expression": "do_validate == True"
    },
    "g_has_output_dir": {
      "type": "expression",
      "expression": "output_dir is not None"
    }
  },
  "actions": {
    "a_to_tla_safe": {
      "type": "compute",
      "compute_unit": "impl:_to_tla_safe",
      "description": "Convert name to TLA+ safe identifier",
      "input_map": {},
      "output_map": {}
    },
    "a_extract_domains": {
      "type": "compute",
      "compute_unit": "impl:_extract_domains",
      "description": "Extract type domains from schema",
      "input_map": {},
      "output_map": {}
    },
    "a_escape_string": {
      "type": "compute",
      "compute_unit": "impl:_escape_tla_string",
      "description": "Escape string for TLA+",
      "input_map": {},
      "output_map": {}
    },
    "a_generate_spec": {
      "type": "compute",
      "compute_unit": "impl:generate_tla",
      "description": "Generate TLA+ specification",
      "input_map": {},
      "output_map": {}
    },
    "a_run_tlc": {
      "type": "compute",
      "compute_unit": "impl:validate_with_tlc",
      "description": "Run TLC model checker",
      "input_map": {},
      "output_map": {}
    },
    "a_save_tla": {
      "type": "compute",
      "compute_unit": "impl:save_tla",
      "description": "Save TLA+ files to disk",
      "input_map": {},
      "output_map": {}
    },
    "a_append_line": {
      "type": "compute",
      "compute_unit": "impl:lines.append",
      "description": "Append line to spec",
      "input_map": {},
      "output_map": {}
    }
  },
  "entry_state": "idle",
  "terminal_states": {
    "complete": {
      "output_schema": {
        "result": {
          "type": "object",
          "non_null": true
        }
      },
      "invariants_guaranteed": [
        "result_produced"
      ]
    },
    "error": {
      "output_schema": {
        "error": {
          "type": "string",
          "non_null": true
        }
      }
    }
  }
}
