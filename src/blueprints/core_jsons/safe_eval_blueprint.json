{
  "$schema": "lpp/v0.1",
  "id": "lpp_safe_eval",
  "name": "L++ Safe Evaluator",
  "version": "1.0.0",
  "description": "Safe expression evaluation with AST-based security",
  "context_schema": {
    "properties": {
      "error": {
        "type": "string"
      },
      "result": {
        "type": "object"
      },
      "expression": {
        "type": "string"
      },
      "scope": {
        "type": "object"
      },
      "ast_tree": {
        "type": "object"
      }
    }
  },
  "states": {
    "idle": {
      "name": "Idle",
      "description": "Ready to evaluate"
    },
    "parsing": {
      "name": "Parsing",
      "description": "Parsing expression into AST"
    },
    "validating": {
      "name": "Validating",
      "description": "Validating AST for safety"
    },
    "evaluating": {
      "name": "Evaluating",
      "description": "Evaluating safe AST"
    },
    "complete": {
      "name": "Complete",
      "description": "Evaluation completed"
    },
    "error": {
      "name": "Error",
      "description": "Evaluation failed"
    }
  },
  "transitions": [
    {
      "id": "t_eval",
      "from": "idle",
      "to": "parsing",
      "on_event": "EVALUATE"
    },
    {
      "id": "t_parsed",
      "from": "parsing",
      "to": "validating",
      "on_event": "PARSE_DONE"
    },
    {
      "id": "t_validated",
      "from": "validating",
      "to": "evaluating",
      "on_event": "VALIDATION_PASSED"
    },
    {
      "id": "t_done",
      "from": "evaluating",
      "to": "complete",
      "on_event": "EVAL_DONE"
    },
    {
      "id": "t_parse_err",
      "from": "parsing",
      "to": "error",
      "on_event": "PARSE_ERROR"
    },
    {
      "id": "t_unsafe",
      "from": "validating",
      "to": "error",
      "on_event": "UNSAFE_EXPRESSION"
    },
    {
      "id": "t_eval_err",
      "from": "evaluating",
      "to": "error",
      "on_event": "EVAL_ERROR"
    },
    {
      "id": "t_reset",
      "from": "*",
      "to": "idle",
      "on_event": "RESET"
    }
  ],
  "gates": {
    "g_has_expression": {
      "type": "expression",
      "expression": "expression is not None and len(expression) > 0"
    },
    "g_valid_ast": {
      "type": "expression",
      "expression": "ast_tree is not None"
    },
    "g_result_ok": {
      "type": "expression",
      "expression": "result == expected"
    }
  },
  "actions": {
    "a_parse_ast": {
      "type": "compute",
      "compute_unit": "impl:ast.parse",
      "description": "Parse expression to AST"
    },
    "a_validate_ast": {
      "type": "compute",
      "compute_unit": "impl:_validate_ast",
      "description": "Validate AST is safe"
    },
    "a_check_complexity": {
      "type": "compute",
      "compute_unit": "impl:self._check_complexity",
      "description": "Check expression complexity"
    },
    "a_visit_node": {
      "type": "compute",
      "compute_unit": "impl:self.visit",
      "description": "Visit AST node"
    },
    "a_resolve_name": {
      "type": "compute",
      "compute_unit": "impl:_resolve_name",
      "description": "Resolve variable name"
    },
    "a_resolve_attr": {
      "type": "compute",
      "compute_unit": "impl:_resolve_attr",
      "description": "Resolve attribute access"
    },
    "a_safe_call": {
      "type": "compute",
      "compute_unit": "impl:SAFE_FUNCTIONS.get",
      "description": "Get safe function"
    },
    "a_raise_error": {
      "type": "compute",
      "compute_unit": "impl:SafeEvalError",
      "description": "Raise safe eval error"
    }
  },
  "entry_state": "idle",
  "terminal_states": [
    "complete",
    "error"
  ]
}
