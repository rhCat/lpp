{
  "$schema": "lpp/v0.2.0",
  "id": "lpp_visualizer",
  "name": "L++ Blueprint Visualizer",
  "version": "1.0.0",
  "description": "Generates visual representations of blueprints (Mermaid, ASCII)",
  "context_schema": {
    "properties": {
      "error": {
        "type": "string"
      },
      "result": {
        "type": "object"
      },
      "blueprint": {
        "type": "object"
      },
      "format": {
        "type": "string",
        "enum": [
          "mermaid",
          "ascii"
        ]
      },
      "output": {
        "type": "string"
      }
    }
  },
  "states": {
    "idle": {
      "name": "Idle",
      "description": "Ready to visualize"
    },
    "loading": {
      "name": "Loading",
      "description": "Loading blueprint data"
    },
    "rendering": {
      "name": "Rendering",
      "description": "Rendering visualization"
    },
    "complete": {
      "name": "Complete",
      "description": "Visualization complete"
    },
    "error": {
      "name": "Error",
      "description": "Visualization failed"
    }
  },
  "transitions": [
    {
      "id": "t_visualize",
      "from": "idle",
      "to": "loading",
      "on_event": "VISUALIZE"
    },
    {
      "id": "t_loaded",
      "from": "loading",
      "to": "rendering",
      "on_event": "LOAD_DONE"
    },
    {
      "id": "t_rendered",
      "from": "rendering",
      "to": "complete",
      "on_event": "RENDER_DONE"
    },
    {
      "id": "t_load_err",
      "from": "loading",
      "to": "error",
      "on_event": "LOAD_ERROR"
    },
    {
      "id": "t_render_err",
      "from": "rendering",
      "to": "error",
      "on_event": "RENDER_ERROR"
    },
    {
      "id": "t_reset",
      "from": "*",
      "to": "idle",
      "on_event": "RESET"
    }
  ],
  "gates": {
    "g_has_blueprint": {
      "type": "expression",
      "expression": "blueprint is not None"
    },
    "g_mermaid_format": {
      "type": "expression",
      "expression": "format == 'mermaid'"
    },
    "g_ascii_format": {
      "type": "expression",
      "expression": "format == 'ascii'"
    }
  },
  "actions": {
    "a_load_states": {
      "type": "compute",
      "compute_unit": "impl:self.states.get",
      "description": "Load state data",
      "input_map": {},
      "output_map": {}
    },
    "a_render_mermaid": {
      "type": "compute",
      "compute_unit": "impl:as_mermaid_logic",
      "description": "Render as Mermaid diagram",
      "input_map": {},
      "output_map": {}
    },
    "a_render_ascii": {
      "type": "compute",
      "compute_unit": "impl:as_ascii",
      "description": "Render as ASCII table",
      "input_map": {},
      "output_map": {}
    },
    "a_enumerate_transitions": {
      "type": "compute",
      "compute_unit": "impl:enumerate",
      "description": "Enumerate transitions",
      "input_map": {},
      "output_map": {}
    },
    "a_append_line": {
      "type": "compute",
      "compute_unit": "impl:lines.append",
      "description": "Append output line",
      "input_map": {},
      "output_map": {}
    },
    "a_join_output": {
      "type": "compute",
      "compute_unit": "impl:join",
      "description": "Join output lines",
      "input_map": {},
      "output_map": {}
    }
  },
  "entry_state": "idle",
  "terminal_states": {
    "complete": {
      "output_schema": {
        "result": {
          "type": "object",
          "non_null": true
        },
        "output": {
          "type": "string",
          "non_null": true
        }
      },
      "invariants_guaranteed": [
        "result_produced"
      ]
    },
    "error": {
      "output_schema": {
        "error": {
          "type": "string",
          "non_null": true
        }
      }
    }
  }
}
