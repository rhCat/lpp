{
  "$schema": "lpp/v0.1",
  "id": "lpp_core",
  "name": "L++ Core Atoms",
  "version": "1.0.0",
  "description": "Core atomic operations: EVALUATE, TRANSITION, MUTATE, DISPATCH",
  "context_schema": {
    "properties": {
      "error": {
        "type": "string"
      },
      "result": {
        "type": "object"
      },
      "expression": {
        "type": "string"
      },
      "scope": {
        "type": "object"
      },
      "context_data": {
        "type": "object"
      }
    }
  },
  "states": {
    "idle": {
      "name": "Idle",
      "description": "Ready for atomic operation"
    },
    "evaluating": {
      "name": "Evaluating",
      "description": "Executing atom_EVALUATE"
    },
    "transitioning": {
      "name": "Transitioning",
      "description": "Executing atom_TRANSITION"
    },
    "mutating": {
      "name": "Mutating",
      "description": "Executing atom_MUTATE"
    },
    "dispatching": {
      "name": "Dispatching",
      "description": "Executing atom_DISPATCH"
    },
    "complete": {
      "name": "Complete",
      "description": "Operation completed"
    },
    "error": {
      "name": "Error",
      "description": "Operation failed"
    }
  },
  "transitions": [
    {
      "id": "t_evaluate",
      "from": "idle",
      "to": "evaluating",
      "on_event": "EVALUATE"
    },
    {
      "id": "t_transition",
      "from": "idle",
      "to": "transitioning",
      "on_event": "TRANSITION"
    },
    {
      "id": "t_mutate",
      "from": "idle",
      "to": "mutating",
      "on_event": "MUTATE"
    },
    {
      "id": "t_dispatch",
      "from": "idle",
      "to": "dispatching",
      "on_event": "DISPATCH"
    },
    {
      "id": "t_eval_done",
      "from": "evaluating",
      "to": "complete",
      "on_event": "EVAL_DONE"
    },
    {
      "id": "t_trans_done",
      "from": "transitioning",
      "to": "complete",
      "on_event": "TRANS_DONE"
    },
    {
      "id": "t_mutate_done",
      "from": "mutating",
      "to": "complete",
      "on_event": "MUTATE_DONE"
    },
    {
      "id": "t_dispatch_done",
      "from": "dispatching",
      "to": "complete",
      "on_event": "DISPATCH_DONE"
    },
    {
      "id": "t_eval_error",
      "from": "evaluating",
      "to": "error",
      "on_event": "EVAL_ERROR"
    },
    {
      "id": "t_trans_error",
      "from": "transitioning",
      "to": "error",
      "on_event": "TRANS_ERROR"
    },
    {
      "id": "t_mutate_error",
      "from": "mutating",
      "to": "error",
      "on_event": "MUTATE_ERROR"
    },
    {
      "id": "t_dispatch_error",
      "from": "dispatching",
      "to": "error",
      "on_event": "DISPATCH_ERROR"
    },
    {
      "id": "t_reset",
      "from": "*",
      "to": "idle",
      "on_event": "RESET"
    }
  ],
  "gates": {
    "g_has_expression": {
      "type": "expression",
      "expression": "expression is not None"
    },
    "g_has_scope": {
      "type": "expression",
      "expression": "scope is not None"
    },
    "g_valid_path": {
      "type": "expression",
      "expression": "path is not None and len(path) > 0"
    }
  },
  "actions": {
    "a_safe_eval": {
      "type": "compute",
      "compute_unit": "impl:safe_eval_bool",
      "description": "Safely evaluate boolean expression"
    },
    "a_create_trace": {
      "type": "compute",
      "compute_unit": "impl:TransitionTrace",
      "description": "Create transition trace"
    },
    "a_get_timestamp": {
      "type": "compute",
      "compute_unit": "impl:datetime.datetime.now",
      "description": "Get current timestamp"
    },
    "a_copy_context": {
      "type": "compute",
      "compute_unit": "impl:context_data.copy",
      "description": "Copy context data"
    },
    "a_split_path": {
      "type": "compute",
      "compute_unit": "impl:path.split",
      "description": "Split path into parts"
    },
    "a_check_type": {
      "type": "compute",
      "compute_unit": "impl:isinstance",
      "description": "Check type of value"
    },
    "a_get_compute_func": {
      "type": "compute",
      "compute_unit": "impl:compute_registry.get",
      "description": "Get compute function from registry"
    },
    "a_call_compute": {
      "type": "compute",
      "compute_unit": "impl:compute_func",
      "description": "Call compute function"
    },
    "a_log": {
      "type": "compute",
      "compute_unit": "impl:print",
      "description": "Log message"
    }
  },
  "entry_state": "idle",
  "terminal_states": [
    "complete",
    "error"
  ]
}
