{
  "$schema": "lpp/v0.2.0",
  "id": "lvp_xray",
  "name": "LVP X-Ray Component",
  "version": "1.0.0",
  "description": "Phase 1: Extract logic blueprint from target Python code",
  "context_schema": {
    "properties": {
      "target_path": {
        "type": "string",
        "description": "Path to target Python file/project"
      },
      "target_name": {
        "type": "string",
        "description": "Name of target for reports"
      },
      "output_dir": {
        "type": "string",
        "description": "Directory for artifacts"
      },
      "lpp_root": {
        "type": "string",
        "description": "L++ framework root"
      },
      "bone_json": {
        "type": "object",
        "description": "Extracted logic blueprint"
      },
      "bone_path": {
        "type": "string",
        "description": "Path to bone JSON file"
      },
      "error": {
        "type": "string",
        "description": "Error message if any"
      }
    }
  },
  "states": {
    "idle": {
      "description": "Awaiting extraction request"
    },
    "extracting": {
      "description": "Extracting logic from target"
    },
    "done": {
      "description": "Extraction complete"
    },
    "error": {
      "description": "Extraction failed"
    }
  },
  "entry_state": "idle",
  "terminal_states": {
    "done": {
      "output_schema": {
        "bone_json": {
          "type": "object",
          "non_null": true
        },
        "bone_path": {
          "type": "string",
          "non_null": true
        }
      },
      "invariants_guaranteed": [
        "logic_extracted"
      ]
    },
    "error": {
      "output_schema": {
        "error": {
          "type": "string",
          "non_null": true
        }
      }
    }
  },
  "gates": {
    "has_target": {
      "type": "expression",
      "expression": "target_path is not None"
    },
    "has_bone": {
      "type": "expression",
      "expression": "bone_json is not None"
    },
    "has_error": {
      "type": "expression",
      "expression": "error is not None"
    },
    "no_error": {
      "type": "expression",
      "expression": "error is None"
    }
  },
  "actions": {
    "set_target_name": {
      "type": "compute",
      "compute_unit": "lvp:set_target_name",
      "input_map": {
        "target_path": "target_path"
      },
      "output_map": {
        "target_name": "target_name"
      }
    },
    "extract_logic": {
      "type": "compute",
      "compute_unit": "lvp:extract_logic",
      "input_map": {
        "target_path": "target_path",
        "output_dir": "output_dir",
        "lpp_root": "lpp_root"
      },
      "output_map": {
        "bone_json": "bone_json",
        "bone_path": "bone_path",
        "error": "error"
      }
    }
  },
  "transitions": [
    {
      "id": "t_start",
      "from": "idle",
      "to": "extracting",
      "on_event": "EXTRACT",
      "gates": [
        "has_target"
      ],
      "actions": [
        "set_target_name",
        "extract_logic"
      ]
    },
    {
      "id": "t_done",
      "from": "extracting",
      "to": "done",
      "on_event": "COMPLETE",
      "gates": [
        "has_bone",
        "no_error"
      ]
    },
    {
      "id": "t_error",
      "from": "extracting",
      "to": "error",
      "on_event": "COMPLETE",
      "gates": [
        "has_error"
      ]
    }
  ]
}
