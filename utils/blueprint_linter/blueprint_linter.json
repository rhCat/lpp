{
  "$schema": "lpp/v0.2.0",
  "id": "lpp_blueprint_linter",
  "name": "L++ Blueprint Linter",
  "version": "1.0.0",
  "description": "Static analysis tool for L++ blueprints - detects issues and suggests improvements",
  "context_schema": {
    "properties": {
      "blueprint": {
        "type": "object",
        "description": "The loaded Blueprint object to lint"
      },
      "blueprint_path": {
        "type": "string",
        "description": "Path to the loaded blueprint file"
      },
      "findings": {
        "type": "array",
        "description": "List of lint findings (issues discovered)"
      },
      "summary": {
        "type": "object",
        "description": "Summary counts by severity (error, warning, info)"
      },
      "metrics": {
        "type": "object",
        "description": "Complexity metrics for the blueprint"
      },
      "report": {
        "type": "string",
        "description": "Generated lint report as formatted text"
      },
      "error": {
        "type": "string",
        "description": "Error message if any"
      },
      "lint_config": {
        "type": "object",
        "description": "Configuration for which rules to apply"
      }
    }
  },
  "states": {
    "idle": {
      "description": "No blueprint loaded, waiting for input"
    },
    "loaded": {
      "description": "Blueprint loaded, ready to lint"
    },
    "linting": {
      "description": "Running lint checks"
    }
  },
  "entry_state": "idle",
  "terminal_states": {
    "error": {
      "output_schema": {
        "error": {
          "type": "string",
          "non_null": true
        }
      }
    },
    "complete": {}
  },
  "gates": {
    "has_blueprint": {
      "type": "expression",
      "expression": "blueprint is not None"
    },
    "no_blueprint": {
      "type": "expression",
      "expression": "blueprint is None"
    },
    "has_findings": {
      "type": "expression",
      "expression": "findings is not None and len(findings) > 0"
    },
    "has_errors": {
      "type": "expression",
      "expression": "summary is not None and summary.get('error', 0) > 0"
    },
    "is_clean": {
      "type": "expression",
      "expression": "summary is not None and summary.get('error', 0) == 0 and summary.get('warning', 0) == 0"
    }
  },
  "actions": {
    "load_blueprint": {
      "type": "compute",
      "compute_unit": "lint:load_blueprint",
      "input_map": {
        "path": "event.payload.path"
      },
      "output_map": {
        "blueprint": "blueprint",
        "blueprint_path": "path",
        "error": "error"
      }
    },
    "init_lint": {
      "type": "compute",
      "compute_unit": "lint:init_lint",
      "input_map": {
        "config": "lint_config"
      },
      "output_map": {
        "findings": "findings",
        "summary": "summary",
        "metrics": "metrics"
      }
    },
    "check_unreachable_states": {
      "type": "compute",
      "compute_unit": "lint:check_unreachable_states",
      "input_map": {
        "blueprint": "blueprint",
        "findings": "findings"
      },
      "output_map": {
        "findings": "findings"
      }
    },
    "check_dead_end_states": {
      "type": "compute",
      "compute_unit": "lint:check_dead_end_states",
      "input_map": {
        "blueprint": "blueprint",
        "findings": "findings"
      },
      "output_map": {
        "findings": "findings"
      }
    },
    "check_unused_gates": {
      "type": "compute",
      "compute_unit": "lint:check_unused_gates",
      "input_map": {
        "blueprint": "blueprint",
        "findings": "findings"
      },
      "output_map": {
        "findings": "findings"
      }
    },
    "check_unused_actions": {
      "type": "compute",
      "compute_unit": "lint:check_unused_actions",
      "input_map": {
        "blueprint": "blueprint",
        "findings": "findings"
      },
      "output_map": {
        "findings": "findings"
      }
    },
    "check_unused_context": {
      "type": "compute",
      "compute_unit": "lint:check_unused_context",
      "input_map": {
        "blueprint": "blueprint",
        "findings": "findings"
      },
      "output_map": {
        "findings": "findings"
      }
    },
    "check_orphaned_transitions": {
      "type": "compute",
      "compute_unit": "lint:check_orphaned_transitions",
      "input_map": {
        "blueprint": "blueprint",
        "findings": "findings"
      },
      "output_map": {
        "findings": "findings"
      }
    },
    "check_missing_gate_refs": {
      "type": "compute",
      "compute_unit": "lint:check_missing_gate_refs",
      "input_map": {
        "blueprint": "blueprint",
        "findings": "findings"
      },
      "output_map": {
        "findings": "findings"
      }
    },
    "check_missing_action_refs": {
      "type": "compute",
      "compute_unit": "lint:check_missing_action_refs",
      "input_map": {
        "blueprint": "blueprint",
        "findings": "findings"
      },
      "output_map": {
        "findings": "findings"
      }
    },
    "check_duplicate_ids": {
      "type": "compute",
      "compute_unit": "lint:check_duplicate_ids",
      "input_map": {
        "blueprint": "blueprint",
        "findings": "findings"
      },
      "output_map": {
        "findings": "findings"
      }
    },
    "check_naming_conventions": {
      "type": "compute",
      "compute_unit": "lint:check_naming_conventions",
      "input_map": {
        "blueprint": "blueprint",
        "findings": "findings"
      },
      "output_map": {
        "findings": "findings"
      }
    },
    "compute_metrics": {
      "type": "compute",
      "compute_unit": "lint:compute_metrics",
      "input_map": {
        "blueprint": "blueprint"
      },
      "output_map": {
        "metrics": "metrics"
      }
    },
    "compute_summary": {
      "type": "compute",
      "compute_unit": "lint:compute_summary",
      "input_map": {
        "findings": "findings"
      },
      "output_map": {
        "summary": "summary"
      }
    },
    "generate_report": {
      "type": "compute",
      "compute_unit": "lint:generate_report",
      "input_map": {
        "blueprint": "blueprint",
        "blueprint_path": "blueprint_path",
        "findings": "findings",
        "summary": "summary",
        "metrics": "metrics"
      },
      "output_map": {
        "report": "report"
      }
    },
    "set_error": {
      "type": "set",
      "target": "error",
      "value_from": "event.payload.message"
    },
    "clear_error": {
      "type": "set",
      "target": "error",
      "value": null
    },
    "clear_findings": {
      "type": "set",
      "target": "findings",
      "value": null
    },
    "unload_blueprint": {
      "type": "set",
      "target": "blueprint",
      "value": null
    },
    "set_config": {
      "type": "set",
      "target": "lint_config",
      "value_from": "event.payload.config"
    }
  },
  "display": {
    "rules": [
      {
        "gate": "is_error",
        "template": "ERROR: {error}"
      },
      {
        "gate": "is_idle",
        "template": "No blueprint loaded. Use LOAD command."
      },
      {
        "gate": "is_complete",
        "template": "Lint complete: {summary.error} errors, {summary.warning} warnings"
      },
      {
        "gate": "is_linting",
        "template": "Linting in progress..."
      },
      {
        "gate": "is_loaded",
        "template": "Loaded: {blueprint_path}"
      },
      {
        "template": "L++ Blueprint Linter"
      }
    ]
  },
  "transitions": [
    {
      "id": "t_load",
      "from": "idle",
      "to": "loaded",
      "on_event": "LOAD",
      "gates": [
        "no_blueprint"
      ],
      "actions": [
        "load_blueprint"
      ]
    },
    {
      "id": "t_load_error",
      "from": "idle",
      "to": "error",
      "on_event": "LOAD_FAILED",
      "actions": [
        "set_error"
      ]
    },
    {
      "id": "t_reload",
      "from": "loaded",
      "to": "loaded",
      "on_event": "LOAD",
      "actions": [
        "load_blueprint",
        "clear_findings"
      ]
    },
    {
      "id": "t_reload_from_complete",
      "from": "complete",
      "to": "loaded",
      "on_event": "LOAD",
      "actions": [
        "load_blueprint",
        "clear_findings"
      ]
    },
    {
      "id": "t_start_lint",
      "from": "loaded",
      "to": "linting",
      "on_event": "LINT",
      "gates": [
        "has_blueprint"
      ],
      "actions": [
        "init_lint"
      ]
    },
    {
      "id": "t_check_unreachable",
      "from": "linting",
      "to": "linting",
      "on_event": "CHECK_UNREACHABLE",
      "actions": [
        "check_unreachable_states"
      ]
    },
    {
      "id": "t_check_dead_end",
      "from": "linting",
      "to": "linting",
      "on_event": "CHECK_DEAD_END",
      "actions": [
        "check_dead_end_states"
      ]
    },
    {
      "id": "t_check_unused_gates",
      "from": "linting",
      "to": "linting",
      "on_event": "CHECK_UNUSED_GATES",
      "actions": [
        "check_unused_gates"
      ]
    },
    {
      "id": "t_check_unused_actions",
      "from": "linting",
      "to": "linting",
      "on_event": "CHECK_UNUSED_ACTIONS",
      "actions": [
        "check_unused_actions"
      ]
    },
    {
      "id": "t_check_unused_context",
      "from": "linting",
      "to": "linting",
      "on_event": "CHECK_UNUSED_CONTEXT",
      "actions": [
        "check_unused_context"
      ]
    },
    {
      "id": "t_check_orphaned",
      "from": "linting",
      "to": "linting",
      "on_event": "CHECK_ORPHANED",
      "actions": [
        "check_orphaned_transitions"
      ]
    },
    {
      "id": "t_check_gate_refs",
      "from": "linting",
      "to": "linting",
      "on_event": "CHECK_GATE_REFS",
      "actions": [
        "check_missing_gate_refs"
      ]
    },
    {
      "id": "t_check_action_refs",
      "from": "linting",
      "to": "linting",
      "on_event": "CHECK_ACTION_REFS",
      "actions": [
        "check_missing_action_refs"
      ]
    },
    {
      "id": "t_check_duplicates",
      "from": "linting",
      "to": "linting",
      "on_event": "CHECK_DUPLICATES",
      "actions": [
        "check_duplicate_ids"
      ]
    },
    {
      "id": "t_check_naming",
      "from": "linting",
      "to": "linting",
      "on_event": "CHECK_NAMING",
      "actions": [
        "check_naming_conventions"
      ]
    },
    {
      "id": "t_finalize",
      "from": "linting",
      "to": "complete",
      "on_event": "FINALIZE",
      "actions": [
        "compute_metrics",
        "compute_summary",
        "generate_report"
      ]
    },
    {
      "id": "t_run_all",
      "from": "loaded",
      "to": "complete",
      "on_event": "LINT_ALL",
      "gates": [
        "has_blueprint"
      ],
      "actions": [
        "init_lint",
        "check_unreachable_states",
        "check_dead_end_states",
        "check_unused_gates",
        "check_unused_actions",
        "check_unused_context",
        "check_orphaned_transitions",
        "check_missing_gate_refs",
        "check_missing_action_refs",
        "check_duplicate_ids",
        "check_naming_conventions",
        "compute_metrics",
        "compute_summary",
        "generate_report"
      ]
    },
    {
      "id": "t_relint",
      "from": "complete",
      "to": "complete",
      "on_event": "LINT_ALL",
      "gates": [
        "has_blueprint"
      ],
      "actions": [
        "init_lint",
        "check_unreachable_states",
        "check_dead_end_states",
        "check_unused_gates",
        "check_unused_actions",
        "check_unused_context",
        "check_orphaned_transitions",
        "check_missing_gate_refs",
        "check_missing_action_refs",
        "check_duplicate_ids",
        "check_naming_conventions",
        "compute_metrics",
        "compute_summary",
        "generate_report"
      ]
    },
    {
      "id": "t_back_to_loaded",
      "from": "complete",
      "to": "loaded",
      "on_event": "BACK",
      "actions": [
        "clear_findings"
      ]
    },
    {
      "id": "t_unload",
      "from": "loaded",
      "to": "idle",
      "on_event": "UNLOAD",
      "actions": [
        "unload_blueprint"
      ]
    },
    {
      "id": "t_unload_from_complete",
      "from": "complete",
      "to": "idle",
      "on_event": "UNLOAD",
      "actions": [
        "unload_blueprint",
        "clear_findings"
      ]
    },
    {
      "id": "t_configure",
      "from": "idle",
      "to": "idle",
      "on_event": "CONFIGURE",
      "actions": [
        "set_config"
      ]
    },
    {
      "id": "t_configure_loaded",
      "from": "loaded",
      "to": "loaded",
      "on_event": "CONFIGURE",
      "actions": [
        "set_config"
      ]
    },
    {
      "id": "t_recover",
      "from": "error",
      "to": "idle",
      "on_event": "CLEAR",
      "actions": [
        "clear_error"
      ]
    }
  ]
}
