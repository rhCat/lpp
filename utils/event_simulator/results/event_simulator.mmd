flowchart TD
    %% L++ Logic CAD Export
    state_idle(["<b>idle</b><br/>No blueprint loaded, waiting for input"]):::entry
    state_error(["<b>error</b><br/>Error state"])
    state_ready(["<b>ready</b><br/>Blueprint loaded, ready to simulate"])
    state_simulating(["<b>simulating</b><br/>Actively simulating, can dispatch events"])
    gate_t_0_0{{"no_blueprint?"}}
    state_idle -- "LOAD" --> gate_t_0_0
    act_t_0_0[["load_blueprint"]]
    gate_t_0_0 -- True --> act_t_0_0
    act_t_0_0 --> state_ready
    act_t_1_0[["set_error"]]
    state_idle -- "LOAD_FAILED" --> act_t_1_0
    act_t_1_0 --> state_error
    act_t_2_0[["load_blueprint"]]
    state_ready -- "LOAD" --> act_t_2_0
    act_t_2_0 --> state_ready
    act_t_3_0[["load_blueprint"]]
    state_simulating -- "LOAD" --> act_t_3_0
    act_t_3_0 --> state_ready
    gate_t_4_0{{"has_blueprint?"}}
    state_ready -- "START" --> gate_t_4_0
    act_t_4_0[["init_simulation, render_status"]]
    gate_t_4_0 -- True --> act_t_4_0
    act_t_4_0 --> state_simulating
    act_t_5_0[["dispatch_event"]]
    state_simulating -- "DISPATCH" --> act_t_5_0
    act_t_5_0 --> state_simulating
    act_t_6_0[["set_context, get_available_events"]]
    state_simulating -- "SET_CONTEXT" --> act_t_6_0
    act_t_6_0 --> state_simulating
    act_t_7_0[["get_available_events, render_status"]]
    state_simulating -- "REFRESH" --> act_t_7_0
    act_t_7_0 --> state_simulating
    act_t_8_0[["evaluate_gates"]]
    state_simulating -- "EVAL_GATES" --> act_t_8_0
    act_t_8_0 --> state_simulating
    act_t_9_0[["fork_simulation"]]
    state_simulating -- "FORK" --> act_t_9_0
    act_t_9_0 --> state_simulating
    gate_t_10_0{{"has_forks?"}}
    state_simulating -- "SWITCH_FORK" --> gate_t_10_0
    act_t_10_0[["switch_fork"]]
    gate_t_10_0 -- True --> act_t_10_0
    act_t_10_0 --> state_simulating
    gate_t_11_0{{"can_step_back?"}}
    state_simulating -- "STEP_BACK" --> gate_t_11_0
    act_t_11_0[["step_back"]]
    gate_t_11_0 -- True --> act_t_11_0
    act_t_11_0 --> state_simulating
    act_t_12_0[["set_sequence"]]
    state_simulating -- "SET_SEQUENCE" --> act_t_12_0
    act_t_12_0 --> state_simulating
    gate_t_13_0{{"has_sequence?"}}
    state_simulating -- "RUN_SEQUENCE" --> gate_t_13_0
    act_t_13_0[["run_sequence"]]
    gate_t_13_0 -- True --> act_t_13_0
    act_t_13_0 --> state_simulating
    act_t_14_0[["fuzz_run"]]
    state_simulating -- "FUZZ" --> act_t_14_0
    act_t_14_0 --> state_simulating
    act_t_15_0[["find_path"]]
    state_simulating -- "FIND_PATH" --> act_t_15_0
    act_t_15_0 --> state_simulating
    act_t_16_0[["explore_state_space"]]
    state_simulating -- "EXPLORE" --> act_t_16_0
    act_t_16_0 --> state_simulating
    act_t_17_0[["render_trace"]]
    state_simulating -- "VIEW_TRACE" --> act_t_17_0
    act_t_17_0 --> state_simulating
    gate_t_18_0{{"has_state_space?"}}
    state_simulating -- "VIEW_SPACE" --> gate_t_18_0
    act_t_18_0[["render_state_space"]]
    gate_t_18_0 -- True --> act_t_18_0
    act_t_18_0 --> state_simulating
    gate_t_19_0{{"has_trace?"}}
    state_simulating -- "EXPORT" --> gate_t_19_0
    act_t_19_0[["export_trace"]]
    gate_t_19_0 -- True --> act_t_19_0
    act_t_19_0 --> state_simulating
    gate_t_20_0{{"can_import?"}}
    state_simulating -- "IMPORT" --> gate_t_20_0
    act_t_20_0[["import_trace"]]
    gate_t_20_0 -- True --> act_t_20_0
    act_t_20_0 --> state_simulating
    act_t_21_0[["reset_simulation"]]
    state_simulating -- "RESET" --> act_t_21_0
    act_t_21_0 --> state_simulating
    state_simulating -- "STOP" --> state_ready
    act_t_23_0[["unload_blueprint"]]
    state_ready -- "UNLOAD" --> act_t_23_0
    act_t_23_0 --> state_idle
    act_t_24_0[["unload_blueprint"]]
    state_simulating -- "UNLOAD" --> act_t_24_0
    act_t_24_0 --> state_idle
    act_t_25_0[["clear_error"]]
    state_error -- "CLEAR" --> act_t_25_0
    act_t_25_0 --> state_idle
    classDef entry fill:#e1f5fe,stroke:#01579b,stroke-width:4px
    classDef terminal fill:#eceff1,stroke:#263238,stroke-width:4px